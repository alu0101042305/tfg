



    
        
        
        
        
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
   
   
   
   
   
   <head>
      <link rel="shortcut icon" href="images/favicon.ico" />
      <meta name="title" content="Red de Control y Vigilancia de la Calidad del Aire de Canarias">
      <meta name="keywords" content="medio ambiente canarias cegca consejería consejeria gobierno canarias portal información documentación medición calidad aire enlaces normativa publicaciones red control vigilancia">
      <meta name="description" content="medioambientecanarias.com Portal de la Red de Control y Vigilancia de la Calidad del Aire de Canarias">
      <meta name="subject" content="Consejería de Medio Ambiente del Gobierno de Canarias - CEGCA">
      <meta name="copyright" content="Consejería de Medio Ambiente del Gobierno de Canarias - Centro de Investigación del Medio Ambiente de Canarias">
      <meta name="robots" content="index,follow,all">
      <meta name="revisit-after" content="15">    
      <title>
         
            
         

Red de Control y Vigilancia de la Calidad del Aire de Canarias - Formulario de datos históricos






      </title>
      

<!-- estilos -->	

<link rel="stylesheet" href="/medioambiente/calidaddelaire/css/comunCecoma.css;jsessionid=DAFACA2C897E499810E675B015088C45.ajp13_aceptable-ap01e_appsrv1" type="text/css" media="screen, print" />
<link rel="stylesheet" href="/medioambiente/calidaddelaire/css/displaytag.css;jsessionid=DAFACA2C897E499810E675B015088C45.ajp13_aceptable-ap01e_appsrv1" type="text/css" media="screen, print" />
<!-- Standard reset, fonts and grids -->
<link rel="stylesheet" type="text/css" href="javascript/yui/build/reset-fonts-grids/reset-fonts-grids.css" />
<!-- CSS for Menu -->
<link rel="stylesheet" type="text/css" href="javascript/yui/build/menu/assets/menu.css" />

    <link rel="stylesheet" type="text/css" href="/medioambiente/calidaddelaire/css/menu.css;jsessionid=DAFACA2C897E499810E675B015088C45.ajp13_aceptable-ap01e_appsrv1" />

    
      <link type="text/css" rel="stylesheet" href="javascript/yui/build/calendar/assets/calendar.css">
<style type="text/css">

#fldSelParametros {
   border: 1px solid #6699CC;
   height: 60px;
   padding-top: 10px;
   padding-bottom: 0px;
   padding-left: 34px;
   padding-bottom: 13px;
   margin-top: 20px;
   position: relative; 
   left: 70px;
}
#fldTablaParametros {
   border: 1px solid #6699CC;
   /*height : 267px;*/
   padding: 10px;
   margin-top : 20px;
   position : relative;
   left : 70px;
}

#fldMarcoFechas {
   border: 1px solid #6699CC;
   width: 700px;
   position: relative;
   left: 70px;
   margin-top: 20px;
   padding: 10px;
}
#divMensajeTipoHist {
   color: #ff0000;
   font-family: Arial,Helvetica,sans-serif;
   font-size: 12px;
   font-style: normal;
   font-weight: bold;
   position: relative;  
   top: 0px;       
   left : 232px;
}
#datosTemporales, #datosValidados {
   position: relative;
   left: 107px;
   top: 3px;
   margin: 5px;  
}
#divFechaInicio, #divFechaFin {
   margin: 5px;
   position : relative;
   left : 150px;
   color: #003399;
}
#divTipoHist {
   margin: 5px;
   position : relative;
   left : 217px;
   color: #003399;
}
#divBotones {
   position : relative;
   left : -18px;
   width : 215px;
}
#divBotones #btLimpiar {
   width : 100px;
   height : 23px;
   margin-bottom : 20px;
   position: relative;
   top: 10px !important;
   top: 175px;
   left: 353px;
}
#divBotones #btEnviar {
   width : 111px;
   height : 23px;
   margin-bottom : 20px;
   position: relative;
   top: 10px !important;
   top: 175px;
   left: 381px;
}

#calendarioInicio {
   position : relative;
   left: 3px;
}
#calendarioFin {
   position : relative;
   left: 3px;
}

#selMesIni, #selMesFin {
   width : 90px;
   z-index: 0;
}

#selAnioIni, #selAnioFin {
   width : 75px;
   z-index: 0;
}

.calnavright {
   visibility : hidden;
}
.calnavleft {
   visibility : hidden;
}

#divTablaFormularioHistoricos {
   background-color: #FFFFFF;
   border: 1px solid #FFCC33;
   color: #333333;
   overflow: hidden;
   margin-right: 60px;
   margin-left: 60px;
   margin-bottom : 25px;
}

#tbEstaciones {
   margin-right: 10px;
}

#listaParametros {
   text-align: center;
   vertical-align: middle;
   font-family: Arial, Helvetica, sans-serif;
   font-size: 12px;
   font-weight: normal;
   color: #000000;
   text-decoration: none;
   background-position: center;
   padding: 2px;
   width: 700px;
   margin-top : 0px;
   margin-bottom :5px;
}
#listaParametros tr {
   height : 26px;
}
#listaParametros td {
   background-color: #FFFFFF;
   font-family: Arial, Helvetica, sans-serif;
   font-size: 12px;
   border: 1px solid #CCCCCC;
}
#listaParametros #encabezado td {
   font-family: Arial, Helvetica, sans-serif;
   font-size: 12px;
   font-weight: normal;
   background-color: #6699CC;
   color: #FFFFFF;
}

#divAvisoval {
   position : relative;
   left :  129px;
   width : 364px;
   color: #ff0000;
   font-family: Arial,Helvetica,sans-serif;
   font-size: 12px;
   font-style: normal;
   font-weight: bold;
}

#divEspera {
  position: relative;
  left: 399px;
  top: 389px;
  top: 398px !important;
  visibility: hidden;
  z-index: 2;
  background-color: #FFFFFF;
  height: 16px;
  width: 289px;
}

</style>    
   </head>
   
   <body>
      <div id="cima_aplicacion">
         <div id="menu_aplicacion">
            







<div id="cecomaMenu" class="yuimenubar">
    <div class="bd">
        <ul class="first-of-type">
            <li class="yuimenubaritem first-of-type"><a href="inicio.do">Inicio</a></li>
            
            <li class="yuimenubaritem">Datos
                <div id="mediciones" class="yuimenu">
                    <div class="bd">
                        <ul>                
                            <li class="yuimenuitem"><a href="datosOnLine.do">Tiempo Real</a></li>
                            <li class="yuimenuitem"><a href="datosHistoricosForm.do">Hist&oacute;ricos</a></li>
                            <li class="yuimenuitem"><a href="descargasDatos.do">Descargas</a></li>
                            <li class="yuimenuitem"><a href="metales.do">Metales y PAH</a></li>
                            <li class="yuimenuitem"><a href="informacion.do">Informaci&oacute;n</a></li>                            
                            <li class="yuimenuitem"><a href="interpretacion.do">Interpretaci&oacute;n</a></li>
                        </ul>
                    </div>
                </div>      
            </li>
                 
            <li class="yuimenubaritem"><a href="ica.do">&Iacute;ndice de calidad del aire</a></li>
            
            <li class="yuimenubaritem"><a href="http://www.bsc.es/caliope-can">Predicci&oacute;n</a></li>
            
            <li class="yuimenubaritem"><a href="legislacion.jsp">Legislaci&oacute;n</a></li>
            
            <li class="yuimenubaritem"><a href="informes2.do">Informes</a></li>

            <li class="yuimenubaritem"><a href="superacionesActuales.do">Superaciones</a></li> 
            
            <li class="yuimenubaritem"><a href="avisos.do">Avisos</a></li>            
            <li class="yuimenubaritem"><a href="documentos.do">Documentos</a></li>            
        </ul>            
    </div>
</div>

         </div>
         <div id="contenido_aplicacion">
            






<!-- mensajes -->

<!-- fin mensajes -->

<!-- errores -->

  <br class="clear" />
  <div id="mensajes">
    <fieldset id="mensError">
      <legend title="Mensajes de Error"><strong>Mensajes de Error</strong></legend> 
      <ul>
        
          <li>
            La lista de parámetros debe tener, como mínimo, un elemento
          </li>
        
      </ul>
    </fieldset>
  </div>
  <br class="clear" />

<!-- fin errores -->
            






<script type="text/javascript" src="javascript/yui/build/yahoo/yahoo.js"></script>
<script type="text/javascript" src="javascript/yui/build/event/event.js" ></script>
<script type="text/javascript" src="javascript/yui/build/dom/dom.js"></script>
<script type="text/javascript" src="javascript/yui/build/calendar/calendar.js"></script>

<!-- FUNCIONES DE MANEJO DE LA TABLA DE ANALIZADORES -->
<script type="text/javascript">

function agregarAnalizador() { 
    var navegador = navigator.appName; 
    idai = document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].value;
    ides = document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value;
    oTabla = document.getElementById("listaParametros");
    filaduplicada = document.getElementById(ides + ';' + idai);
    if (navegador == "Microsoft Internet Explorer") {         
        if (idai==0){ //seleccionar todos los parametros de la estacion activa
            for (var y=1;y<document.forms[0].tbParametros.options.length;y++) { 
                filaduplicada = document.getElementById( ides+ ';' + document.forms[0].tbParametros.options[y].value);
                if (filaduplicada == null){
                    oFila = oTabla.insertRow();
            
                    /* Trampona para que el IE no mueva la capa de fechas solo cuando se pase el cursor
                        y mientras tapen los botones, hacemos visible el textbox de fecha
                        y lugo invisible, de esa manera repinta esa zona*/
                    document.getElementById('tbFechaIni').style.visibility = "visible";
                    document.getElementById('tbFechaIni').style.visibility = "hidden";
            
                    oFila.setAttribute("id", ides + ';' + document.forms[0].tbParametros.options[y].value);
                    var oCelda1 = oFila.insertCell();
                    oCelda1.innerHTML = document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text;
                    var oCelda2 = oFila.insertCell();
                    oCelda2.innerHTML = document.forms[0].tbParametros.options[y].text;
                    var oCelda3 = oFila.insertCell();
                    oCelda3.innerHTML = "<img src='images/eliminar.gif' value='Borrar' onclick='borrarAnalizador(this);' style='cursor:hand'/>";
                    window.focus();
                    agregarParametroSesion('AgregaParametroAction.do?idai='+document.forms[0].tbParametros.options[y].value);
                    divErrores = document.getElementById("erroresjs");
                    divErrores.innerHTML = "";
                }
            }
            
        }
        else if (filaduplicada == null && idai > 0) { //oTabla.rows.length < 11 &&
            oFila = oTabla.insertRow();
            
            /* Trampona para que el IE no mueva la capa de fechas solo cuando se pase el cursor
             y mientras tapen los botones, hacemos visible el textbox de fecha
             y lugo invisible, de esa manera repinta esa zona*/
            document.getElementById('tbFechaIni').style.visibility = "visible";
            document.getElementById('tbFechaIni').style.visibility = "hidden";
            
            oFila.setAttribute("id", ides + ';' + idai);
            var oCelda1 = oFila.insertCell();
            oCelda1.innerHTML = document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text;
            var oCelda2 = oFila.insertCell();
            oCelda2.innerHTML = document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].text;
            var oCelda3 = oFila.insertCell();
            oCelda3.innerHTML = "<img src='images/eliminar.gif' value='Borrar' onclick='borrarAnalizador(this);' style='cursor:hand'/>";
            window.focus();
            agregarParametroSesion('AgregaParametroAction.do?');
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "";
        }
        else if (filaduplicada != null) {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Par&aacute;metro repetido.</p>";
        }  
        else if (idai < 0) {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Seleccione un analizador.</p>";
        }        
        else {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>Tan solo se pueden seleccionar 8 par&aacute;metros.</p>";    
        }         
    }
    else {
        if (idai==0){ //seleccionar todos los parametros de la estacion activa
            for (var y=1;y<document.forms[0].tbParametros.options.length;y++) { 
                filaduplicada = document.getElementById( ides+ ';' + document.forms[0].tbParametros.options[y].value);
                if (filaduplicada == null){
                    oFila = document.createElement("tr");
                    oFila.setAttribute("id", ides + ';' + document.forms[0].tbParametros.options[y].value);
                    oCelda1 = document.createElement("td");            
                    oCelda2 = document.createElement("td");
                    oCelda3 = document.createElement("td");
                    textoEstacion = document.createTextNode(document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text);
                    textoNombre = document.createTextNode(document.forms[0].tbParametros.options[y].text);
            
                    botonBorrado = document.createElement("img");
                    botonBorrado.setAttribute("src", "images/eliminar.gif"); 
                    botonBorrado.setAttribute("value", "borrar");
                    botonBorrado.setAttribute("style", "cursor:pointer");
                    botonBorrado.onclick = function(){borrarAnalizador(this)};
                    oCelda1.appendChild(textoEstacion);
                    oCelda2.appendChild(textoNombre);
                    oCelda3.appendChild(botonBorrado);
                    oFila.appendChild(oCelda1);
                    oFila.appendChild(oCelda2);
                    oFila.appendChild(oCelda3);
                    oTabla.appendChild(oFila);
                    window.focus();
                    agregarParametroSesion('AgregaParametroAction.do?idai='+document.forms[0].tbParametros.options[y].value);
                    divErrores = document.getElementById("erroresjs");
                    divErrores.innerHTML = "";   
                }
            }
            
        }
        else if (filaduplicada == null  && idai > 0) { //oTabla.childNodes.length < 11 &&
            oFila = document.createElement("tr");
            oFila.setAttribute("id", ides + ';' + idai);
            oCelda1 = document.createElement("td");            
            oCelda2 = document.createElement("td");
            oCelda3 = document.createElement("td");
            textoEstacion = document.createTextNode(document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text);
            textoNombre = document.createTextNode(document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].text);           
            
            botonBorrado = document.createElement("img");
            botonBorrado.setAttribute("src", "images/eliminar.gif"); 
            botonBorrado.setAttribute("value", "borrar");
            botonBorrado.setAttribute("style", "cursor:pointer");
            botonBorrado.onclick = function(){borrarAnalizador(this)};
            oCelda1.appendChild(textoEstacion);
            oCelda2.appendChild(textoNombre);
            oCelda3.appendChild(botonBorrado);
            oFila.appendChild(oCelda1);
            oFila.appendChild(oCelda2);
            oFila.appendChild(oCelda3);
            oTabla.appendChild(oFila);
            agregarParametroSesion('AgregaParametroAction.do?');
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "";            
        }            
        else if (filaduplicada != null) {
            //alert("Parametro repetido.");
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Par&aacute;metro repetido.</p>";
        }
        else if (idai < 0) {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Seleccione un analizador.</p>";
        }        
        else {
            //alert("Tan solo puede seleccionar 8 parametros.");
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Tan solo se pueden seleccionar 8 par&aacute;metros.</p>";            
        } 
    }                    
} 

function borrarAnalizador(obj) {
    oTabla = document.getElementById("listaParametros");
    var navegador = navigator.appName;
    if (navegador == "Microsoft Internet Explorer") {		
        var filaBorrable = obj.parentElement.parentElement;		
        document.all("listaParametros").deleteRow(filaBorrable.rowIndex);
        /* Trampona para que el IE no mueva la capa de fechas solo cuando se pase el cursor
        y tape los botones, hacemos visible el textbox de fecha
        y lugo invisible, de esa manera repinta esa zona*/
        document.getElementById('tbFechaIni').style.visibility = "visible";
        document.getElementById('tbFechaIni').style.visibility = "hidden";          
    }
    else {
        filaBorrable = obj.parentNode.parentNode; 
        oTabla.removeChild(filaBorrable);      
    }
    var parametros = filaBorrable.id.split(";");
    var ides = parametros[0];
    var idai = parametros[1];
    borrarParametroSesion("BorrarParametroAction.do?idai=" + idai + "&ides=" + ides );
    divErrores = document.getElementById("erroresjs");
    divErrores.innerHTML = "";      
    anularControles(false);
}

function borrarTodosAnalizadores() {
    document.location.href = "datosHistoricosForm.do";
}

function restablecerFormulario() {
    borrarTodosAnalizadores();
    borrarParametrosSesion();
}
</script>


<!-- FUNCIONES DE MANEJO DE FECHAS -->
<script type="text/javascript">

function handleSelectInicio(type,args,obj) { 
    var dates = args[0]; 
    var date = dates[0]; 
    var anio = date[0], mes = date[1], dia = date[2];     
    
    var selMesIni = document.getElementById("selMesIni");
    selMesIni.selectedIndex = mes-1;
    
    var selAnioIni = document.getElementById("selAnioIni");
    for (var y=0;y<selAnioIni.options.length;y++) { 
        if (selAnioIni.options[y].text == anio) { 
            selAnioIni.selectedIndex = y; 
            break; 
        } 
    }
    var txtDate1 = document.getElementById("tbFechaIni"); 
    txtDate1.value = dia + "/" + mes + "/" + anio; 
} 

function updateCalIni() {
    //Si es mensual pasamos del calendario y usamos solo mes y anio de los combos
    if (document.forms[0].pinteg.selectedIndex < 3) {
        var selMesIni = document.getElementById("selMesIni");
        var selAnioIni = document.getElementById("selAnioIni");

        var mesini = parseInt(selMesIni.options[selMesIni.selectedIndex].value);   
        var anioini = parseInt(selAnioIni.options[selAnioIni.selectedIndex].value);

        if (! isNaN(mesini) && ! isNaN(anioini)) {
            YAHOO.historicos.calendar.cal1.cfg.setProperty("pagedate", mesini + "/" + anioini);
            YAHOO.historicos.calendar.cal1.render();
        } 
    }
    else {
      var txtDate1 = document.getElementById("tbFechaIni"); 
      var selMesIni = document.getElementById("selMesIni");
      var selAnioIni = document.getElementById("selAnioIni");

      var mesini = parseInt(selMesIni.options[selMesIni.selectedIndex].value);   
      var anioini = parseInt(selAnioIni.options[selAnioIni.selectedIndex].value);      
      txtDate1.value = "1/" + mesini + "/" + anioini;  
    }
}

function handleSelectFin(type,args,obj) { 
    var dates = args[0]; 
    var date = dates[0]; 
    var anio = date[0], mes = date[1], dia = date[2];     
    
    var selMesFin = document.getElementById("selMesFin");
    selMesFin.selectedIndex = mes-1;
    
    var selAnioFin = document.getElementById("selAnioFin");
    for (var y=0;y<selAnioFin.options.length;y++) { 
        if (selAnioFin.options[y].text == anio) { 
            selAnioFin.selectedIndex = y; 
            break; 
        } 
    }    
    var txtDate1 = document.getElementById("tbFechaFin"); 
    txtDate1.value = dia + "/" + mes + "/" + anio; 
} 

function updateCalFin() {
    //Si es mensual pasamos del calendario y usamos solo mes y anio de los combos
    if (document.forms[0].pinteg.selectedIndex < 3) {
        var selMesFin = document.getElementById("selMesFin");    
        var selAnioFin = document.getElementById("selAnioFin");

        var mesfin = parseInt(selMesFin.options[selMesFin.selectedIndex].value);    
        var aniofin = parseInt(selAnioFin.options[selAnioFin.selectedIndex].value);

        if (! isNaN(mesfin) && ! isNaN(aniofin)) {
            YAHOO.historicos.calendar.cal2.cfg.setProperty("pagedate", mesfin + "/" + aniofin);
            YAHOO.historicos.calendar.cal2.render();
        }
    }
    else {
      var txtDate1 = document.getElementById("tbFechaFin"); 
      var selMesFin = document.getElementById("selMesFin");
      var selAnioFin = document.getElementById("selAnioFin");

      var mesfin = parseInt(selMesFin.options[selMesFin.selectedIndex].value);   
      var aniofin = parseInt(selAnioFin.options[selAnioFin.selectedIndex].value);      
      txtDate1.value = "1/" + mesfin + "/" + aniofin;  
    }
}

YAHOO.namespace("historicos.calendar");
function init() { 
    cargarComboAnios();
    
    precargarFechas();
    if (document.forms[0].tipohist[0].checked) {
        marcarFecha();
    }
    else {
        //Si es mensual no recargamos el calendario
        if (document.forms[0].pinteg.selectedIndex < 3) {
            YAHOO.historicos.calendar.cal1 = new YAHOO.widget.Calendar("cal1","calendarioInicio", { mindate:"1/1/1997" });
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MONTHS_LONG",    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("WEEKDAYS_SHORT",    ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"]);                 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("START_WEEKDAY", "1" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_DAY_POSITION", "1" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_MONTH_POSITION", "2" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_YEAR_POSITION", "3" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("CLOSE", "TRUE");
            YAHOO.historicos.calendar.cal1.render();
            YAHOO.historicos.calendar.cal1.selectEvent.subscribe(handleSelectInicio, YAHOO.historicos.calendar.cal1, true);
            YAHOO.util.Event.addListener(["selMesIni","selAnioIni"], "change", updateCalIni);
        }
        updateCalIni();
    }
    //Si es mensual no recargamos el calendario
    if (document.forms[0].pinteg.selectedIndex < 3) {
        YAHOO.historicos.calendar.cal2 = new YAHOO.widget.Calendar("cal2","calendarioFin", { mindate:"1/1/1997" });
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MONTHS_LONG",    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]);                 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("WEEKDAYS_SHORT",    ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"]);                 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("START_WEEKDAY", "1" );  
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MDY_DAY_POSITION", "1" ); 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MDY_MONTH_POSITION", "2" ); 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MDY_YEAR_POSITION", "3" ); 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("CLOSE", "TRUE");                
        YAHOO.historicos.calendar.cal2.render();           
        YAHOO.historicos.calendar.cal2.selectEvent.subscribe(handleSelectFin, YAHOO.historicos.calendar.cal2, true);
        YAHOO.util.Event.addListener(["selMesFin","selAnioFin"], "change", updateCalFin);
    }
    document.forms[0].tbEstaciones.disabled = false;
    updateCalFin();
}
YAHOO.util.Event.addListener(window, "load", init);

function cargarComboAnios() {
    var fecha = new Date();
    var anioFIN = fecha.getFullYear();
    var anioINI = anioFIN - 10;
    
    var selAnio = document.getElementById("selAnioIni");
    
    selAnio.clear;
    for (var y=anioINI;y<=anioFIN;y++) { 
        selAnio.options[y-anioINI]=new Option(y, y);
    }
    
    var selAnio = document.getElementById("selAnioFin");
    
    selAnio.clear;
    for (var y=anioINI;y<=anioFIN;y++) { 
        selAnio.options[y-anioINI]=new Option(y, y);
    }
}

function precargarFechas() {
    var fecha = new Date();
    var mes = fecha.getMonth() + 1;
    var dia = fecha.getDate();
    var anio = fecha.getFullYear();
    
    var selMesFin = document.getElementById("selMesFin");
    selMesFin.selectedIndex = mes-1;
    
    var selAnioFin = document.getElementById("selAnioFin");
    for (var y=0;y<selAnioFin.options.length;y++) { 
        if (selAnioFin.options[y].text == anio) { 
            selAnioFin.selectedIndex = y; 
            break; 
        } 
    }    
    var txtDate1 = document.getElementById("tbFechaFin"); 
    txtDate1.value = dia + "/" + mes + "/" + anio;     
    
    
    var selMesIni = document.getElementById("selMesIni");
    selMesIni.selectedIndex = mes-1;
    
    var selAnioIni = document.getElementById("selAnioIni");
    for (var y=0;y<selAnioIni.options.length;y++) { 
        if (selAnioIni.options[y].text == anio) { 
            selAnioIni.selectedIndex = y; 
            break; 
        } 
    }
    var txtDate1 = document.getElementById("tbFechaIni"); 
    txtDate1.value = dia + "/" + mes + "/" + anio; 
}

function marcarFecha() {
    fechaval = document.getElementById("tbFechaVal").value;
    fechaval = fechaval.substring(0, 10);
    parametros = fechaval.split("-");
    fechaval = parametros[2] + "/" + parametros[1] + "/" + parametros[0];
    document.getElementById("tbFechaIni").value = fechaval;
    recargarCalendarioInicio();
}

function desmarcarFecha() {
    document.forms[0].selMesIni.disabled = false;
    document.forms[0].selAnioIni.disabled = false; 
    YAHOO.historicos.calendar.cal1 = new YAHOO.widget.Calendar("cal1","calendarioInicio", { mindate:"1-1-1997" });
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MONTHS_LONG",    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("WEEKDAYS_SHORT",    ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"]);                 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("START_WEEKDAY", "1" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_DAY_POSITION", "1" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_MONTH_POSITION", "2" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_YEAR_POSITION", "3" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("CLOSE", "TRUE");
    YAHOO.historicos.calendar.cal1.render();
    YAHOO.historicos.calendar.cal1.selectEvent.subscribe(handleSelectInicio, YAHOO.historicos.calendar.cal1, true);
    YAHOO.util.Event.addListener(["selMesIni","selAnioIni"], "change", updateCalIni);
    updateCalIni();    
}    

function recargarCalendarioInicio() { 
    document.forms[0].selMesIni.disabled = true;
    document.forms[0].selAnioIni.disabled = true; 
    document.getElementById("calendarioInicio").innerHTML = "<img src='images/fechano.jpg'>";
}

</script>


<!-- FUNCIONES DE AJAX PARA EL RELLENADO DE COMBOS DEPENDIENTES Y GRABACION EN SESION -->
<script type="text/javascript">

var xmlHttp;

function createXMLHttpRequest() {
    try {
        if (window.ActiveXObject) {
            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
        } 
        else if (window.XMLHttpRequest) {
            xmlHttp = new XMLHttpRequest();
        }        
    }
    catch (e) {
        xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
    }
}

function doRequestUsingGETEstacion(url) {
    if (document.forms[0].tbEstaciones.selectedIndex != 0 &&
       document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value != 0 ) {
        createXMLHttpRequest();
        queryString =   url ;
        queryString = queryString + "&estacion="+document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value;
        queryString = queryString + "&sid=" + Math.random();
        if (xmlHttp != null) {
            xmlHttp.onreadystatechange = manejadorCambioEstado;
            /*El metodo open tiene 3 parametros, la accion GET o POST, el destino, y si se procesa asincronamente o no*/
            anularControles(true);
            xmlHttp.open("GET", queryString, true);
            xmlHttp.send(null);
            /*Habilitamos el combo de analogicas y el boton de agregar*/        
        }
        else {
            divErrores = document.getElementById("errores");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Su navegador no soporta XMLHTTP. Recomendamos <a href='http://www.mozilla-europe.org/es/products/firefox/' target='_blank'>Mozilla Firefox</a></p>";        
        }
    }
    else {
        anularControles(true);
    }
}

function agregarParametroSesion(url) { 
    oTabla = document.getElementById("listaParametros");
    //if (oTabla.childNodes.length <= 11) {
        createXMLHttpRequest();
        queryString = url ;
        if (document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].value>0)
            queryString = queryString + "&idai="+document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].value;
        queryString = queryString + "&estacion="+document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value;
        queryString = queryString + "&sid="+Math.random();        
        xmlHttp.onreadystatechange = manejadorCambioEstado;
        xmlHttp.open("GET", queryString, true);
        xmlHttp.send(null);
    //}
}

function borrarParametrosSesion() {
    createXMLHttpRequest();
    xmlHttp.onreadystatechange = manejadorCambioEstado;
    xmlHttp.open("GET", "BorrarParametrosSesion.do", true);
    xmlHttp.send(null);
}

function borrarParametroSesion(url) {
    createXMLHttpRequest();
    xmlHttp.onreadystatechange = manejadorCambioEstado;
    xmlHttp.open("GET", url, true);
    xmlHttp.send(null);
}

function manejadorCambioEstado() {
    try {
        if(xmlHttp.readyState == 4) {
            if(xmlHttp.status == 200) {            
                procesaResultado(); 
                anularControles(false);
            }
            else {
                //divErrores = document.getElementById("errores");
                //divErrores.innerHTML = "<p class='txt09roj'>ERROR: Se ha producido un error en la conexi&oacute;n remota.</p>";
            }
        }
    }
    catch (e) {
        divErrores = document.getElementById("errores");
        divErrores.innerHTML = "<p class='txt09roj'>ERROR: Se ha producido un error en la conexi&oacute;n remota con el servidor. Compruebe su conexi&oacute;n.</p>";        
    }
}

function procesaResultado() {
    if (document.forms[0].tbEstaciones.selectedIndex != 0) {
        var xmlRespuesta = xmlHttp.responseXML;
        
        var comprueba =xmlRespuesta.getElementsByTagName("parametros");
            
        var i = 0;
        var oAnalogicas = xmlRespuesta.getElementsByTagName("parametro");
        
        if (comprueba.length >0 ) //estoy cargando los parametros en el combo
            if (oAnalogicas.length > 0) {
                document.getElementById('tbParametros').options.length = oAnalogicas.length;// - 1;
                document.getElementById('tbParametros').options[i] = new Option("Todos los parXXXXmetros",0);
                i++;
                while (i <= oAnalogicas.length) {
                    tmpParametro = oAnalogicas[i-1]; //va de 0 a oAnalogicas.length-1
                    document.getElementById('tbParametros').options[i] = new Option(getText(tmpParametro.getElementsByTagName("texto").item(0)), getText(tmpParametro.getElementsByTagName("idai").item(0)));
                    i++;
                }
            } else {
                document.getElementById('tbParametros').options.length = 0;
            }   
    }
}

/*Con esta funcion obtenemos el texto del elemento tanto con el tramposo IE como con el resto*/
function getText(elemento) {
    if (window.ActiveXObject) {
        return elemento.text;
    } 
    else {
        return elemento.textContent;
    }
}


function anularControles(estado) {
    document.forms[0].tbParametros.disabled = estado;
    document.forms[0].btAgregar.disabled = estado;
}


function mostrarIntervalo() {
    var pinteg = document.forms[0].pinteg.options[document.forms[0].pinteg.selectedIndex].value;
    if (pinteg == "D30") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 7 d&iacute;as como m&aacute;ximo</p>";
        //init();
    }
    else if (pinteg == "D60" || pinteg == "D8") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 31 d&iacute;as como m&aacute;ximo</p>";
        //init();
    }   
    else if (pinteg == "D24") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 365 d&iacute;as como m&aacute;ximo</p>";
        //init();
    }
    else if (pinteg == "DME") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 5 años como m&aacute;ximo</p>";
        document.getElementById("calendarioInicio").innerHTML = "<img src='images/fechano.jpg' style='postion: relative; left: -3px'>"; 
        document.getElementById("calendarioFin").innerHTML = "<img src='images/fechano.jpg' style='postion: relative; left: -3px'>"; 
        //init();
    }
    updateCalIni();
    updateCalFin();
}

//panel de espera
function crearDiv(nombre){
	var div = document.createElement('div');
	div.name=nombre;
	div.id=nombre;
	div.style.position="absolute";
	div.style.background="gray";
        div.style.height="500%";
        div.style.width="100%";
	div.style.top="0px";
	div.style.left="0px";
	div.style.opacity="0.4";
	div.style.zIndex="1000";
	div.style.filter="alpha(opacity=20)";
	div.style.border="thin outset #0099FF";
	return div;
}
function crearCustomDiv(nombre,top,left,height,width,color){
	var div = document.createElement('div');
	div.name=nombre;
	div.id=nombre;
	div.style.position="absolute";
        div.style.overflow="hidden";
	div.style.background=color;
        div.style.height=height;
        div.style.width=width;
	div.style.top=top;
	div.style.left=left;
	div.style.opacity="1";
	div.style.zIndex="1000";
	div.style.filter="alpha(opacity=100)";
	div.style.border="thin outset #6699CC";
	return div;
}
function panelEspera(rotulo){
    var div = document.createElement('div');
    div.style.position="relative";
    div.style.height="100%";
    div.style.width="100%";
    div.style.top="0px";
    div.style.left="0px";
    div.style.textAlign="center";
    div.innerHTML="<p class=\"txt11bla\" style=\"margin-top:10%\">"+rotulo+"</p></br><img src=\"images/pleasewait.gif\"/><p class=\"txt11bla\" style=\"margin-top:10%\">Este proceso puede durar varios minutos</p><a href='datosHistoricosForm.do'><p>Cancelar</p></a>";
    return div;
}
function esperando(texto){
	var div = crearDiv("esperando");
	document.body.insertBefore(div, document.body.firstChild)
	div = crearCustomDiv("subesperando","30%","35%","150px","30%","#003399");
	div.appendChild(panelEspera(texto));
	document.body.appendChild(div);
}

function cerrarEsperando(){
	var c =	document.getElementById("subesperando");
	document.body.removeChild(c);
	var c =	document.getElementById("esperando");
	document.body.removeChild(c);
}



</script>


<div id="cabeceraseccion">
    <table width="99%" cellspacing="0" cellpadding="0" border="0" summary="cabecera">
        <tbody>
            <tr>
                <td width="5"/>
                <td valign="top" bgcolor="#ffeb99"><p>Consulta de datos hist&oacute;ricos</p></td>
                <td width="5"/>
            </tr>
            <tr><td colspan="3">&nbsp;</td></tr>
        </tbody>
    </table>
</div> 

<div id="divTablaFormularioHistoricos">
    <form action="datosHistoricos.do" title="Formulario datos historicos" method="post" name="formDatosHistoricos">
        <table>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td>
                                <fieldset id="fldMarcoFechas">
                                    <legend>Tipo de dato y fechas</legend>
                                    <table>                                       
                                        
                                            <tr>
                                                <td colspan="2">
                                                    <div id="divAvisoval" style="display:none;">
                                                        <p>Datos temporales disponibles desde el último d&iacute;a de validaci&oacute;n</p>
                                                    </div>
                                                </td>                                                   
                                            </tr>
                                         
                                        <tr>                                           
                                            <td align="center">
                                                <div id="datosTemporales" style="display:none;">
                                                    <label>Datos temporales</label>
                                                    
                                                        <input name="tipohist" type="radio" value="temporales" onclick="marcarFecha()" />
                                                    
                                                    
                                                </div>
                                            </td>
                                            <td align="center">
                                                <div id="datosValidados"  style="display:none;">
                                                    <label>Datos validados</label>
                                                    <input name="tipohist" type="radio" value="validados" checked onclick="desmarcarFecha()"/>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">                                                    
                                                <div id="divTipoHist">                                        
                                                    Tipo de hist&oacute;rico:
                                                    <select name="pinteg" id="pinteg" onclick="mostrarIntervalo()">
                                                        <option value="D60">Horario</option>
                                                        <option value="D8">OctoHorario</option>
                                                        <option value="D24">Diario</option>
                                                        <option value="DME">Mensual</option>
                                                    </select>
                                                </div> <!-- divTipoHist -->  
                                                <div id="divMensajeTipoHist"><p>Seleccione 31 d&iacute;as como m&aacute;ximo</p></div>
                                            </td>
                                        </tr>                                         
                                        <tr>
                                            <td align="left" width="200">
                                                <div id="divFechaInicio">
                                                    <p>Fecha inicial:</p>
                                                    <select id="selMesIni">
                                                        <option value="1">Enero</option>
                                                        <option value="2">Febrero</option>
                                                        <option value="3">Marzo</option>
                                                        <option value="4">Abril</option>
                                                        <option value="5">Mayo</option>
                                                        <option value="6">Junio</option>
                                                        <option value="7">Julio</option>
                                                        <option value="8">Agosto</option>
                                                        <option value="9">Septiembre</option>
                                                        <option value="10">Octubre</option>
                                                        <option value="11">Noviembre</option>
                                                        <option value="12">Diciembre</option>
                                                    </select>
                                                    <select id="selAnioIni">
                                                        
                                                    </select>   
                                                    <input type="text" name="fechaini" id="tbFechaIni" style="visibility: hidden; width: 0px; height: 0px;" />
                                                    <input type="text" name="fechavalidacion" id="tbFechaVal" style="visibility: hidden; width: 0px; height: 0px;" value='2020-03-30'  />
                                                    <div id="calendarioInicio"></div>
                                                </div>
                                            </td>
                                            <td align="left" width="200">
                                                <div id="divFechaFin">
                                                    <p>Fecha final:</p>                                                                                              
                                                    <select id="selMesFin">
                                                        <option value="1">Enero</option>
                                                        <option value="2">Febrero</option>
                                                        <option value="3">Marzo</option>
                                                        <option value="4">Abril</option>
                                                        <option value="5">Mayo</option>
                                                        <option value="6">Junio</option>
                                                        <option value="7">Julio</option>
                                                        <option value="8">Agosto</option>
                                                        <option value="9">Septiembre</option>
                                                        <option value="10">Octubre</option>
                                                        <option value="11">Noviembre</option>
                                                        <option value="12">Diciembre</option>
                                                    </select>
                                                    <select id="selAnioFin">
                                                        
                                                    </select>
                                                    <input type="text" name="fechafin" id="tbFechaFin" style="visibility: hidden; width: 0px; height: 0px;" />
                                                    <div id="calendarioFin"></div>
                                                </div> <!-- divFechaFin -->
                                            </td>                                                                                  
                                        </tr>                                        
                                    </table>
                                </fieldset> <!-- divMarcoFechas -->                                    
                            </td>
                        </tr>
                    </table>
                    
                    <table>
                        <tr>
                            <td>
                                <fieldset id="fldSelParametros"> 
                                    <legend>Par&aacute;metros disponibles</legend>
                                    <table>
                                        <tr>
                                            <td>Estaciones (Ordenadas por Zona):<br /> 
                                                <select name="estacion" id="tbEstaciones" onchange="doRequestUsingGETEstacion('CargaAnalogXEstacion.do?');" id="tbEstaciones" disabled style="width: 280px;">
                                                    <option value="0">Seleccione una estación</option>
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Lanzarote - Fuerteventura ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="31">Arrecife</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="114">Casa Palacio-Puerto del Rosario</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="27">Centro de Arte</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="44">Ciudad Deportiva-Arrecife</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="32">Costa Teguise</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="130">El Charco-Pto del Rosario</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="154">Las Caletas-Teguise</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="28">Parque de La Piedra</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="153">Portatil  Ed.Polivalente-Pto del Rosario</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="120">Tefia-Puerto del Rosario</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="109">Torre Meteorologica Las Salinas</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="110">Torre Meteorologica Punta Grande</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="184">U. Movil - Gran Tarajal</option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: La Palma - La Gomera - El Hierro ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="224">Centro de Visitantes - SS Gomera</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="128">Echedo-Valverde</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="30">El Pilar-Sta Cruz de La Palma</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="29">La Grama-Breña Alta</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="127">Las Balsas-S. Andres y Sauces</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="143">Las Galanas-SS Gomera</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="141">Residencia Escolar-SS Gomera</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="115">San Antonio-Breña Baja </option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Las Palmas de GC ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="24">Jinamar fase 3</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="33">Mercado Central</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="34">Nestor Alamo</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="244">San Nicolas</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="26">Torre meteorologica CT Jinamar</option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Norte de Gran Canaria ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="113">Polideportivo Afonso-Arucas</option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Norte de Tenerife ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="43">Balsa de Zamora-Los Realejos</option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Sta Cruz-La Laguna ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="1">Casa Cuna</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="155">Comandancia Maritima-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="117">Deposito Tristan-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="121">Garcia Escamez-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="156">Hacienda-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="36">Los Gladiolos</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="2">Mercatenerife</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="147">Palmetum-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="122">Parque La Granja-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="119">Piscina Municipal-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="151">Portatil  Bomberos-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="152">Portatil  Comisaria-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="126">Puerta Litoral-Refineria</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="125">Puerta Principal-Refineria</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="4">Refineria</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="3">Refineria-Torre Meteorologica</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="264">San Lazaro (UM3)</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="112">Tena Artigas-Sta Cruz de Tenerife</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="140">Tio Pino-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="37">Tome Cano</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="5">Viera y Clavijo</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="116">Vuelta Los Pajaros-Sta Cruz de TF</option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Sur de Gran Canaria ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="6">Aguimes</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="7">Arinaga</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="118">Camping Temisas- Sta Lucia de T</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="8">Castillo Romeral</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="23">Jinamar</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="45">La Loma-Telde</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="25">Lezcano</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="38">Parque de San Juan-Telde</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="9">Playa del Ingles</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="10">San Agustin</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="11">Sardina</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="111">Torre Meteorologica Tirajana</option>
                                                                                                         
                                                    
                                                        
                                                            <option value="0" class="selectzona">---- Zona: Sur de Tenerife ----</option>
                                                        
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="12">Barranco Hondo</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="16">Buzanada</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="13">Caletillas</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="123">Deposito La Guancha-Candelaria</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="17">El Rio</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="18">Galletas</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="19">Granadilla</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="14">Igueste</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="39">La Hidalga-Arafo</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="20">Medano</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="21">San Isidro</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="22">Tajao</option>
                                                                                                         
                                                    
                                                        
                                                        
                                                            <option value="15">Torre Meteorologica Candelaria</option>
                                                                                                         
                                                    
                                                </select>
                                            </td>
                                            <td>Parámetros:<br />  
                                                <select name="parametro" id="tbParametros" disabled style="width: 300px;">
                                                    <option value="0">Seleccione un par&aacute;metro</option>        
                                                    
                                                </select>
                                                <input type="button" name="btAgregar" value="Agregar" onclick="agregarAnalizador();" disabled>
                                                </td> 
                                        </tr> 
                                    </table>
                                </fieldset> <!-- divSelParametros -->
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <fieldset id="fldTablaParametros">
                                    <legend>Par&aacute;metros seleccionados (en el gráfico se visualizan los 8 primeros parámetros)</legend>
                                    <div id="erroresjs"></div> 
                                    <table id="listaParametros" style="table-layout: fixed;" class="listaParametros">
                                        <tbody>
                                            <tr id="encabezado">
                                                <td width="75">Estaci&oacute;n</td>
                                                <td width="150">Par&aacute;metro</td>
                                                <td width="50">Borrar</td>
                                            </tr>
                                        </tbody>
                                    </table> 
                                </fieldset><!-- tablaParametrosDiv-->
                            </td>
                        </tr>
                    </table>
                    
                </td>
            </tr>
        </table>
        <table  align="center">
            <tr><td height="30"></td></tr>
            <tr>
                <td>
                    <div>
                        <table align="center">
                            <tr>
                                <td align="center">
                                    <input type="reset" value="Limpiar todo" onclick="restablecerFormulario()" id="btLimpiar" class="btn" title="LIMPIAR TODO" alt="Restablecer">
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <input type="submit" value="Enviar consulta" id="btEnviar" class="btn" alt="Enviar consulta">
                                </td>
                            </tr>
                        </table>
                    </div> <!-- divBotones -->
                </td>
            </tr>
            <tr><td height="30"></td></tr>
        </table>
    </form>
</div> <!-- divTablaFormularioHistoricos -->


         </div>
      </div>
      
<!-- javascript -->

<!-- MENU -->
<!-- Namespace source file -->
<script type="text/javascript" src="javascript/yui/build/yahoo/yahoo.js"></script>
<!-- Dependency source files -->
<script type="text/javascript" src="javascript/yui/build/event/event.js"></script>
<script type="text/javascript" src="javascript/yui/build/dom/dom.js"></script>
<script type="text/javascript" src="javascript/yui/build/animation/animation.js"></script>
<!-- Container source file -->
<script type="text/javascript" src="javascript/yui/build/container/container_core.js"></script>
<!-- Menu source file -->
<script type="text/javascript" src="javascript/yui/build/menu/menu.js"></script>
<script type="text/javascript" src="javascript/menu.js"></script>

<script type="text/javascript" src="/medioambiente/calidaddelaire/javascript/alba/ValidacionFechas.js;jsessionid=DAFACA2C897E499810E675B015088C45.ajp13_aceptable-ap01e_appsrv1" ></script>
<script type="text/javascript" src="/medioambiente/calidaddelaire/javascript/alba/jsrsClient.js;jsessionid=DAFACA2C897E499810E675B015088C45.ajp13_aceptable-ap01e_appsrv1" ></script>
      <script type="text/javascript" src="javascript/yui/build/yahoo/yahoo.js"></script>
<script type="text/javascript" src="javascript/yui/build/event/event.js" ></script>
<script type="text/javascript" src="javascript/yui/build/dom/dom.js"></script>
<script type="text/javascript" src="javascript/yui/build/calendar/calendar.js"></script>

<!-- FUNCIONES DE MANEJO DE LA TABLA DE ANALIZADORES -->
<script type="text/javascript">

function agregarAnalizador() { 
    var navegador = navigator.appName; 
    idai = document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].value;
    ides = document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value;
    oTabla = document.getElementById("listaParametros");
    filaduplicada = document.getElementById(ides + ';' + idai);
    if (navegador == "Microsoft Internet Explorer") {         
        if (idai==0){ //seleccionar todos los parametros de la estacion activa
            for (var y=1;y<document.forms[0].tbParametros.options.length;y++) { 
                filaduplicada = document.getElementById( ides+ ';' + document.forms[0].tbParametros.options[y].value);
                if (filaduplicada == null){
                    oFila = oTabla.insertRow();
            
                    /* Trampona para que el IE no mueva la capa de fechas solo cuando se pase el cursor
                        y mientras tapen los botones, hacemos visible el textbox de fecha
                        y lugo invisible, de esa manera repinta esa zona*/
                    document.getElementById('tbFechaIni').style.visibility = "visible";
                    document.getElementById('tbFechaIni').style.visibility = "hidden";
            
                    oFila.setAttribute("id", ides + ';' + document.forms[0].tbParametros.options[y].value);
                    var oCelda1 = oFila.insertCell();
                    oCelda1.innerHTML = document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text;
                    var oCelda2 = oFila.insertCell();
                    oCelda2.innerHTML = document.forms[0].tbParametros.options[y].text;
                    var oCelda3 = oFila.insertCell();
                    oCelda3.innerHTML = "<img src='images/eliminar.gif' value='Borrar' onclick='borrarAnalizador(this);' style='cursor:hand'/>";
                    window.focus();
                    agregarParametroSesion('AgregaParametroAction.do?idai='+document.forms[0].tbParametros.options[y].value);
                    divErrores = document.getElementById("erroresjs");
                    divErrores.innerHTML = "";
                }
            }
            
        }
        else if (filaduplicada == null && idai > 0) { //oTabla.rows.length < 11 &&
            oFila = oTabla.insertRow();
            
            /* Trampona para que el IE no mueva la capa de fechas solo cuando se pase el cursor
             y mientras tapen los botones, hacemos visible el textbox de fecha
             y lugo invisible, de esa manera repinta esa zona*/
            document.getElementById('tbFechaIni').style.visibility = "visible";
            document.getElementById('tbFechaIni').style.visibility = "hidden";
            
            oFila.setAttribute("id", ides + ';' + idai);
            var oCelda1 = oFila.insertCell();
            oCelda1.innerHTML = document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text;
            var oCelda2 = oFila.insertCell();
            oCelda2.innerHTML = document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].text;
            var oCelda3 = oFila.insertCell();
            oCelda3.innerHTML = "<img src='images/eliminar.gif' value='Borrar' onclick='borrarAnalizador(this);' style='cursor:hand'/>";
            window.focus();
            agregarParametroSesion('AgregaParametroAction.do?');
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "";
        }
        else if (filaduplicada != null) {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Par&aacute;metro repetido.</p>";
        }  
        else if (idai < 0) {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Seleccione un analizador.</p>";
        }        
        else {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>Tan solo se pueden seleccionar 8 par&aacute;metros.</p>";    
        }         
    }
    else {
        if (idai==0){ //seleccionar todos los parametros de la estacion activa
            for (var y=1;y<document.forms[0].tbParametros.options.length;y++) { 
                filaduplicada = document.getElementById( ides+ ';' + document.forms[0].tbParametros.options[y].value);
                if (filaduplicada == null){
                    oFila = document.createElement("tr");
                    oFila.setAttribute("id", ides + ';' + document.forms[0].tbParametros.options[y].value);
                    oCelda1 = document.createElement("td");            
                    oCelda2 = document.createElement("td");
                    oCelda3 = document.createElement("td");
                    textoEstacion = document.createTextNode(document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text);
                    textoNombre = document.createTextNode(document.forms[0].tbParametros.options[y].text);
            
                    botonBorrado = document.createElement("img");
                    botonBorrado.setAttribute("src", "images/eliminar.gif"); 
                    botonBorrado.setAttribute("value", "borrar");
                    botonBorrado.setAttribute("style", "cursor:pointer");
                    botonBorrado.onclick = function(){borrarAnalizador(this)};
                    oCelda1.appendChild(textoEstacion);
                    oCelda2.appendChild(textoNombre);
                    oCelda3.appendChild(botonBorrado);
                    oFila.appendChild(oCelda1);
                    oFila.appendChild(oCelda2);
                    oFila.appendChild(oCelda3);
                    oTabla.appendChild(oFila);
                    window.focus();
                    agregarParametroSesion('AgregaParametroAction.do?idai='+document.forms[0].tbParametros.options[y].value);
                    divErrores = document.getElementById("erroresjs");
                    divErrores.innerHTML = "";   
                }
            }
            
        }
        else if (filaduplicada == null  && idai > 0) { //oTabla.childNodes.length < 11 &&
            oFila = document.createElement("tr");
            oFila.setAttribute("id", ides + ';' + idai);
            oCelda1 = document.createElement("td");            
            oCelda2 = document.createElement("td");
            oCelda3 = document.createElement("td");
            textoEstacion = document.createTextNode(document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].text);
            textoNombre = document.createTextNode(document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].text);           
            
            botonBorrado = document.createElement("img");
            botonBorrado.setAttribute("src", "images/eliminar.gif"); 
            botonBorrado.setAttribute("value", "borrar");
            botonBorrado.setAttribute("style", "cursor:pointer");
            botonBorrado.onclick = function(){borrarAnalizador(this)};
            oCelda1.appendChild(textoEstacion);
            oCelda2.appendChild(textoNombre);
            oCelda3.appendChild(botonBorrado);
            oFila.appendChild(oCelda1);
            oFila.appendChild(oCelda2);
            oFila.appendChild(oCelda3);
            oTabla.appendChild(oFila);
            agregarParametroSesion('AgregaParametroAction.do?');
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "";            
        }            
        else if (filaduplicada != null) {
            //alert("Parametro repetido.");
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Par&aacute;metro repetido.</p>";
        }
        else if (idai < 0) {
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Seleccione un analizador.</p>";
        }        
        else {
            //alert("Tan solo puede seleccionar 8 parametros.");
            divErrores = document.getElementById("erroresjs");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Tan solo se pueden seleccionar 8 par&aacute;metros.</p>";            
        } 
    }                    
} 

function borrarAnalizador(obj) {
    oTabla = document.getElementById("listaParametros");
    var navegador = navigator.appName;
    if (navegador == "Microsoft Internet Explorer") {		
        var filaBorrable = obj.parentElement.parentElement;		
        document.all("listaParametros").deleteRow(filaBorrable.rowIndex);
        /* Trampona para que el IE no mueva la capa de fechas solo cuando se pase el cursor
        y tape los botones, hacemos visible el textbox de fecha
        y lugo invisible, de esa manera repinta esa zona*/
        document.getElementById('tbFechaIni').style.visibility = "visible";
        document.getElementById('tbFechaIni').style.visibility = "hidden";          
    }
    else {
        filaBorrable = obj.parentNode.parentNode; 
        oTabla.removeChild(filaBorrable);      
    }
    var parametros = filaBorrable.id.split(";");
    var ides = parametros[0];
    var idai = parametros[1];
    borrarParametroSesion("BorrarParametroAction.do?idai=" + idai + "&ides=" + ides );
    divErrores = document.getElementById("erroresjs");
    divErrores.innerHTML = "";      
    anularControles(false);
}

function borrarTodosAnalizadores() {
    document.location.href = "datosHistoricosForm.do";
}

function restablecerFormulario() {
    borrarTodosAnalizadores();
    borrarParametrosSesion();
}
</script>


<!-- FUNCIONES DE MANEJO DE FECHAS -->
<script type="text/javascript">

function handleSelectInicio(type,args,obj) { 
    var dates = args[0]; 
    var date = dates[0]; 
    var anio = date[0], mes = date[1], dia = date[2];     
    
    var selMesIni = document.getElementById("selMesIni");
    selMesIni.selectedIndex = mes-1;
    
    var selAnioIni = document.getElementById("selAnioIni");
    for (var y=0;y<selAnioIni.options.length;y++) { 
        if (selAnioIni.options[y].text == anio) { 
            selAnioIni.selectedIndex = y; 
            break; 
        } 
    }
    var txtDate1 = document.getElementById("tbFechaIni"); 
    txtDate1.value = dia + "/" + mes + "/" + anio; 
} 

function updateCalIni() {
    //Si es mensual pasamos del calendario y usamos solo mes y anio de los combos
    if (document.forms[0].pinteg.selectedIndex < 3) {
        var selMesIni = document.getElementById("selMesIni");
        var selAnioIni = document.getElementById("selAnioIni");

        var mesini = parseInt(selMesIni.options[selMesIni.selectedIndex].value);   
        var anioini = parseInt(selAnioIni.options[selAnioIni.selectedIndex].value);

        if (! isNaN(mesini) && ! isNaN(anioini)) {
            YAHOO.historicos.calendar.cal1.cfg.setProperty("pagedate", mesini + "/" + anioini);
            YAHOO.historicos.calendar.cal1.render();
        } 
    }
    else {
      var txtDate1 = document.getElementById("tbFechaIni"); 
      var selMesIni = document.getElementById("selMesIni");
      var selAnioIni = document.getElementById("selAnioIni");

      var mesini = parseInt(selMesIni.options[selMesIni.selectedIndex].value);   
      var anioini = parseInt(selAnioIni.options[selAnioIni.selectedIndex].value);      
      txtDate1.value = "1/" + mesini + "/" + anioini;  
    }
}

function handleSelectFin(type,args,obj) { 
    var dates = args[0]; 
    var date = dates[0]; 
    var anio = date[0], mes = date[1], dia = date[2];     
    
    var selMesFin = document.getElementById("selMesFin");
    selMesFin.selectedIndex = mes-1;
    
    var selAnioFin = document.getElementById("selAnioFin");
    for (var y=0;y<selAnioFin.options.length;y++) { 
        if (selAnioFin.options[y].text == anio) { 
            selAnioFin.selectedIndex = y; 
            break; 
        } 
    }    
    var txtDate1 = document.getElementById("tbFechaFin"); 
    txtDate1.value = dia + "/" + mes + "/" + anio; 
} 

function updateCalFin() {
    //Si es mensual pasamos del calendario y usamos solo mes y anio de los combos
    if (document.forms[0].pinteg.selectedIndex < 3) {
        var selMesFin = document.getElementById("selMesFin");    
        var selAnioFin = document.getElementById("selAnioFin");

        var mesfin = parseInt(selMesFin.options[selMesFin.selectedIndex].value);    
        var aniofin = parseInt(selAnioFin.options[selAnioFin.selectedIndex].value);

        if (! isNaN(mesfin) && ! isNaN(aniofin)) {
            YAHOO.historicos.calendar.cal2.cfg.setProperty("pagedate", mesfin + "/" + aniofin);
            YAHOO.historicos.calendar.cal2.render();
        }
    }
    else {
      var txtDate1 = document.getElementById("tbFechaFin"); 
      var selMesFin = document.getElementById("selMesFin");
      var selAnioFin = document.getElementById("selAnioFin");

      var mesfin = parseInt(selMesFin.options[selMesFin.selectedIndex].value);   
      var aniofin = parseInt(selAnioFin.options[selAnioFin.selectedIndex].value);      
      txtDate1.value = "1/" + mesfin + "/" + aniofin;  
    }
}

YAHOO.namespace("historicos.calendar");
function init() { 
    cargarComboAnios();
    
    precargarFechas();
    if (document.forms[0].tipohist[0].checked) {
        marcarFecha();
    }
    else {
        //Si es mensual no recargamos el calendario
        if (document.forms[0].pinteg.selectedIndex < 3) {
            YAHOO.historicos.calendar.cal1 = new YAHOO.widget.Calendar("cal1","calendarioInicio", { mindate:"1/1/1997" });
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MONTHS_LONG",    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("WEEKDAYS_SHORT",    ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"]);                 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("START_WEEKDAY", "1" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_DAY_POSITION", "1" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_MONTH_POSITION", "2" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_YEAR_POSITION", "3" ); 
            YAHOO.historicos.calendar.cal1.cfg.setProperty("CLOSE", "TRUE");
            YAHOO.historicos.calendar.cal1.render();
            YAHOO.historicos.calendar.cal1.selectEvent.subscribe(handleSelectInicio, YAHOO.historicos.calendar.cal1, true);
            YAHOO.util.Event.addListener(["selMesIni","selAnioIni"], "change", updateCalIni);
        }
        updateCalIni();
    }
    //Si es mensual no recargamos el calendario
    if (document.forms[0].pinteg.selectedIndex < 3) {
        YAHOO.historicos.calendar.cal2 = new YAHOO.widget.Calendar("cal2","calendarioFin", { mindate:"1/1/1997" });
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MONTHS_LONG",    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]);                 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("WEEKDAYS_SHORT",    ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"]);                 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("START_WEEKDAY", "1" );  
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MDY_DAY_POSITION", "1" ); 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MDY_MONTH_POSITION", "2" ); 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("MDY_YEAR_POSITION", "3" ); 
        YAHOO.historicos.calendar.cal2.cfg.setProperty("CLOSE", "TRUE");                
        YAHOO.historicos.calendar.cal2.render();           
        YAHOO.historicos.calendar.cal2.selectEvent.subscribe(handleSelectFin, YAHOO.historicos.calendar.cal2, true);
        YAHOO.util.Event.addListener(["selMesFin","selAnioFin"], "change", updateCalFin);
    }
    document.forms[0].tbEstaciones.disabled = false;
    updateCalFin();
}
YAHOO.util.Event.addListener(window, "load", init);

function cargarComboAnios() {
    var fecha = new Date();
    var anioFIN = fecha.getFullYear();
    var anioINI = anioFIN - 10;
    
    var selAnio = document.getElementById("selAnioIni");
    
    selAnio.clear;
    for (var y=anioINI;y<=anioFIN;y++) { 
        selAnio.options[y-anioINI]=new Option(y, y);
    }
    
    var selAnio = document.getElementById("selAnioFin");
    
    selAnio.clear;
    for (var y=anioINI;y<=anioFIN;y++) { 
        selAnio.options[y-anioINI]=new Option(y, y);
    }
}

function precargarFechas() {
    var fecha = new Date();
    var mes = fecha.getMonth() + 1;
    var dia = fecha.getDate();
    var anio = fecha.getFullYear();
    
    var selMesFin = document.getElementById("selMesFin");
    selMesFin.selectedIndex = mes-1;
    
    var selAnioFin = document.getElementById("selAnioFin");
    for (var y=0;y<selAnioFin.options.length;y++) { 
        if (selAnioFin.options[y].text == anio) { 
            selAnioFin.selectedIndex = y; 
            break; 
        } 
    }    
    var txtDate1 = document.getElementById("tbFechaFin"); 
    txtDate1.value = dia + "/" + mes + "/" + anio;     
    
    
    var selMesIni = document.getElementById("selMesIni");
    selMesIni.selectedIndex = mes-1;
    
    var selAnioIni = document.getElementById("selAnioIni");
    for (var y=0;y<selAnioIni.options.length;y++) { 
        if (selAnioIni.options[y].text == anio) { 
            selAnioIni.selectedIndex = y; 
            break; 
        } 
    }
    var txtDate1 = document.getElementById("tbFechaIni"); 
    txtDate1.value = dia + "/" + mes + "/" + anio; 
}

function marcarFecha() {
    fechaval = document.getElementById("tbFechaVal").value;
    fechaval = fechaval.substring(0, 10);
    parametros = fechaval.split("-");
    fechaval = parametros[2] + "/" + parametros[1] + "/" + parametros[0];
    document.getElementById("tbFechaIni").value = fechaval;
    recargarCalendarioInicio();
}

function desmarcarFecha() {
    document.forms[0].selMesIni.disabled = false;
    document.forms[0].selAnioIni.disabled = false; 
    YAHOO.historicos.calendar.cal1 = new YAHOO.widget.Calendar("cal1","calendarioInicio", { mindate:"1-1-1997" });
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MONTHS_LONG",    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("WEEKDAYS_SHORT",    ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"]);                 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("START_WEEKDAY", "1" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_DAY_POSITION", "1" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_MONTH_POSITION", "2" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("MDY_YEAR_POSITION", "3" ); 
    YAHOO.historicos.calendar.cal1.cfg.setProperty("CLOSE", "TRUE");
    YAHOO.historicos.calendar.cal1.render();
    YAHOO.historicos.calendar.cal1.selectEvent.subscribe(handleSelectInicio, YAHOO.historicos.calendar.cal1, true);
    YAHOO.util.Event.addListener(["selMesIni","selAnioIni"], "change", updateCalIni);
    updateCalIni();    
}    

function recargarCalendarioInicio() { 
    document.forms[0].selMesIni.disabled = true;
    document.forms[0].selAnioIni.disabled = true; 
    document.getElementById("calendarioInicio").innerHTML = "<img src='images/fechano.jpg'>";
}

</script>


<!-- FUNCIONES DE AJAX PARA EL RELLENADO DE COMBOS DEPENDIENTES Y GRABACION EN SESION -->
<script type="text/javascript">

var xmlHttp;

function createXMLHttpRequest() {
    try {
        if (window.ActiveXObject) {
            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
        } 
        else if (window.XMLHttpRequest) {
            xmlHttp = new XMLHttpRequest();
        }        
    }
    catch (e) {
        xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
    }
}

function doRequestUsingGETEstacion(url) {
    if (document.forms[0].tbEstaciones.selectedIndex != 0 &&
       document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value != 0 ) {
        createXMLHttpRequest();
        queryString =   url ;
        queryString = queryString + "&estacion="+document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value;
        queryString = queryString + "&sid=" + Math.random();
        if (xmlHttp != null) {
            xmlHttp.onreadystatechange = manejadorCambioEstado;
            /*El metodo open tiene 3 parametros, la accion GET o POST, el destino, y si se procesa asincronamente o no*/
            anularControles(true);
            xmlHttp.open("GET", queryString, true);
            xmlHttp.send(null);
            /*Habilitamos el combo de analogicas y el boton de agregar*/        
        }
        else {
            divErrores = document.getElementById("errores");
            divErrores.innerHTML = "<p class='txt09roj'>ERROR: Su navegador no soporta XMLHTTP. Recomendamos <a href='http://www.mozilla-europe.org/es/products/firefox/' target='_blank'>Mozilla Firefox</a></p>";        
        }
    }
    else {
        anularControles(true);
    }
}

function agregarParametroSesion(url) { 
    oTabla = document.getElementById("listaParametros");
    //if (oTabla.childNodes.length <= 11) {
        createXMLHttpRequest();
        queryString = url ;
        if (document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].value>0)
            queryString = queryString + "&idai="+document.forms[0].tbParametros.options[document.forms[0].tbParametros.selectedIndex].value;
        queryString = queryString + "&estacion="+document.forms[0].tbEstaciones.options[document.forms[0].tbEstaciones.selectedIndex].value;
        queryString = queryString + "&sid="+Math.random();        
        xmlHttp.onreadystatechange = manejadorCambioEstado;
        xmlHttp.open("GET", queryString, true);
        xmlHttp.send(null);
    //}
}

function borrarParametrosSesion() {
    createXMLHttpRequest();
    xmlHttp.onreadystatechange = manejadorCambioEstado;
    xmlHttp.open("GET", "BorrarParametrosSesion.do", true);
    xmlHttp.send(null);
}

function borrarParametroSesion(url) {
    createXMLHttpRequest();
    xmlHttp.onreadystatechange = manejadorCambioEstado;
    xmlHttp.open("GET", url, true);
    xmlHttp.send(null);
}

function manejadorCambioEstado() {
    try {
        if(xmlHttp.readyState == 4) {
            if(xmlHttp.status == 200) {            
                procesaResultado(); 
                anularControles(false);
            }
            else {
                //divErrores = document.getElementById("errores");
                //divErrores.innerHTML = "<p class='txt09roj'>ERROR: Se ha producido un error en la conexi&oacute;n remota.</p>";
            }
        }
    }
    catch (e) {
        divErrores = document.getElementById("errores");
        divErrores.innerHTML = "<p class='txt09roj'>ERROR: Se ha producido un error en la conexi&oacute;n remota con el servidor. Compruebe su conexi&oacute;n.</p>";        
    }
}

function procesaResultado() {
    if (document.forms[0].tbEstaciones.selectedIndex != 0) {
        var xmlRespuesta = xmlHttp.responseXML;
        
        var comprueba =xmlRespuesta.getElementsByTagName("parametros");
            
        var i = 0;
        var oAnalogicas = xmlRespuesta.getElementsByTagName("parametro");
        
        if (comprueba.length >0 ) //estoy cargando los parametros en el combo
            if (oAnalogicas.length > 0) {
                document.getElementById('tbParametros').options.length = oAnalogicas.length;// - 1;
                document.getElementById('tbParametros').options[i] = new Option("Todos los par&aacute;metros",0);
                i++;
                while (i <= oAnalogicas.length) {
                    tmpParametro = oAnalogicas[i-1]; //va de 0 a oAnalogicas.length-1
                    document.getElementById('tbParametros').options[i] = new Option(getText(tmpParametro.getElementsByTagName("texto").item(0)), getText(tmpParametro.getElementsByTagName("idai").item(0)));
                    i++;
                }
            } else {
                document.getElementById('tbParametros').options.length = 0;
            }   
    }
}

/*Con esta funcion obtenemos el texto del elemento tanto con el tramposo IE como con el resto*/
function getText(elemento) {
    if (window.ActiveXObject) {
        return elemento.text;
    } 
    else {
        return elemento.textContent;
    }
}


function anularControles(estado) {
    document.forms[0].tbParametros.disabled = estado;
    document.forms[0].btAgregar.disabled = estado;
}


function mostrarIntervalo() {
    var pinteg = document.forms[0].pinteg.options[document.forms[0].pinteg.selectedIndex].value;
    if (pinteg == "D30") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 7 d&iacute;as como m&aacute;ximo</p>";
        //init();
    }
    else if (pinteg == "D60" || pinteg == "D8") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 31 d&iacute;as como m&aacute;ximo</p>";
        //init();
    }   
    else if (pinteg == "D24") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 365 d&iacute;as como m&aacute;ximo</p>";
        //init();
    }
    else if (pinteg == "DME") {
        document.getElementById("divMensajeTipoHist").innerHTML = "<p>Seleccione 5 aÃ±os como m&aacute;ximo</p>";
        document.getElementById("calendarioInicio").innerHTML = "<img src='images/fechano.jpg' style='postion: relative; left: -3px'>"; 
        document.getElementById("calendarioFin").innerHTML = "<img src='images/fechano.jpg' style='postion: relative; left: -3px'>"; 
        //init();
    }
    updateCalIni();
    updateCalFin();
}

//panel de espera
function crearDiv(nombre){
	var div = document.createElement('div');
	div.name=nombre;
	div.id=nombre;
	div.style.position="absolute";
	div.style.background="gray";
        div.style.height="500%";
        div.style.width="100%";
	div.style.top="0px";
	div.style.left="0px";
	div.style.opacity="0.4";
	div.style.zIndex="1000";
	div.style.filter="alpha(opacity=20)";
	div.style.border="thin outset #0099FF";
	return div;
}
function crearCustomDiv(nombre,top,left,height,width,color){
	var div = document.createElement('div');
	div.name=nombre;
	div.id=nombre;
	div.style.position="absolute";
        div.style.overflow="hidden";
	div.style.background=color;
        div.style.height=height;
        div.style.width=width;
	div.style.top=top;
	div.style.left=left;
	div.style.opacity="1";
	div.style.zIndex="1000";
	div.style.filter="alpha(opacity=100)";
	div.style.border="thin outset #6699CC";
	return div;
}
function panelEspera(rotulo){
    var div = document.createElement('div');
    div.style.position="relative";
    div.style.height="100%";
    div.style.width="100%";
    div.style.top="0px";
    div.style.left="0px";
    div.style.textAlign="center";
    div.innerHTML="<p class=\"txt11bla\" style=\"margin-top:10%\">"+rotulo+"</p></br><img src=\"images/pleasewait.gif\"/><p class=\"txt11bla\" style=\"margin-top:10%\">Este proceso puede durar varios minutos</p><a href='datosHistoricosForm.do'><p>Cancelar</p></a>";
    return div;
}
function esperando(texto){
	var div = crearDiv("esperando");
	document.body.insertBefore(div, document.body.firstChild)
	div = crearCustomDiv("subesperando","30%","35%","150px","30%","#003399");
	div.appendChild(panelEspera(texto));
	document.body.appendChild(div);
}

function cerrarEsperando(){
	var c =	document.getElementById("subesperando");
	document.body.removeChild(c);
	var c =	document.getElementById("esperando");
	document.body.removeChild(c);
}



</script>
   </body>
</html>



